### Подключение к серверу через SFTP

Мы уже писали, SFTP работает с использованием SSH. Это означает, что к удаленному узлу можно подключиться или с паролем, или по ключу (проще и безопасней).

Подключение к удаленному узлу по SSH:

  ```
ssh hostname@ip_remote_host
  ```

Если используется не стандартный 22 порт для SSH, добавьте параметр -p:

```
ssh -p port_number hostname@ip_remote_host
```

После успешного подключения по SSH завершите сессию и проверьте возможность подключения уже по протоколу SFTP. Для этого введите:

```
sftp hostname@ip_remote_host
```

Если используется не стандартный 22 порт для SSH, добавьте параметр -p:

```
sftp -P port_number hostname@ip_remote_host
```

### Вызов и использование справки SFTP

```
sftp> help
```

Подключаясь по протоколу SFTP к удаленному серверу, вы будете ограничены в возможности использования многих команд, доступных при работе на локальном компьютере или при подключении по SSH.

### Порт, используемый SFTP, и его изменение

Стандартным для установления соединения по протоколам SFTP и SSH является порт 22, но это можно изменить. Перед тем как изменить порт в конфигурации, необходимо открыть данный порт в брандмауэре. Для различных брандмауэров будут использоваться свои команды:

```
UFW (по умолчанию в Ubuntu): 
sudo ufw allow 6500/tcp 

FirewallD (по умолчанию в CentOS): 
sudo firewall-cmd --permanent --zone=public --add-port=6500/tcpsudo firewall-cmd --reload 

SELinux (используется в CentOS в дополнение к FirewallD): 
sudo semanage port -a -t ssh_port_t -p tcp 6500 

Iptables: 
sudo iptables -A INPUT -p tcp --dport 6500 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT
```

Далее необходимо изменить порт в схеме конфигурации SSH. Для этого откройте на редактирование файл sshd_config на удаленном узле, который выступает в роли сервера:

```
sudo nano /etc/ssh/sshd_config
```

Внутри файла найдите строку:

```
#Port 22
```

Если строка уже изменялась, она может выглядеть как:

```
Port number_port
```

Необходимо изменить эту строку, например, на `Port 6500`, где 6500 — номер нового порта.

Данное правило вступит в силу, только если в начале строки нет хэштега #. Также не забудьте сохранить файл.

Теперь необходимо перезагрузить службу SSH:

```
Ubuntu: 
sudo systemctl restart ssh 

CentOS: 
sudo systemctl restart sshd
```

Чтобы инициировать SFTP-подключение с клиента с использованием нового порта, необходимо, как мы уже упомянули, использовать параметр `-P`:

```
sftp -P port_number hostname@ip_remote_host
```


