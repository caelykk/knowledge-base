
Компьютеры в сети общаются по числовым адресам — **IP‑адресам**. 

Людям удобно оперировать именами (например, `www.example.com`), а не набором чисел. **DNS переводит эти имена в IP‑адреса**, с которыми могут работать компьютеры.

Когда клиент (например, браузер) получит URL, ему нужно выяснить, **к какому серверу отправлять запрос**. 

Для поиска **IP-адреса** нужного домена используется **Domain Name System** (**DNS**, система доменных имён).
### DNS

**DNS (Domain Name System)** — это распределённая система хранения и обработки информации о доменных зонах. **DNS** сопоставляет человеко-читаемые доменные имена (например, `example.com`) с машинно-читаемыми **IP-адресами** серверов (например, `93.184.216.34`).

Это ключевой компонент Интернета, без которого браузер не смог бы найти сервер, когда пользователь вводит адрес сайта.

Когда браузеру известен домен (например, `www.site.ru`), он не может напрямую *«дозвониться»* по имени — нужен **IP**. **DNS** отвечает за это сопоставление и позволяет клиенту узнать, к какому серверу устанавливать соединение.

### История возникновения

Вначале, до **DNS**, на каждой машине был единый файл `hosts`, который содержал сопоставление имён и **IP‑адресов**. Но при росте Интернета такая система перестала быть масштабируемой. Поэтому в **1983 году** Полом Мокапетрисом (Paul Mockapetris) была разработана распределённая система **DNS**.

### Сопоставление имен

Способы сопоставления имен:
1) **Прямое сопоставление:** доменное имя → IP‑адрес.
	- Пользователь набирает в строке браузера [www.1cloud.ru](http://www.1cloud.ru/) и нажимает Enter. 
	- **Браузер посылает DNS‑запрос** локальному DNS‑серверу (обычно провайдера).
	- Если сервер **уже знает IP** (например, из кэша), он отвечает сразу.
	- Если нет, DNS‑сервер начинает **пересылать запрос по уровням иерархии**:
		- — корневой сервер →  
		- — сервер домена верхнего уровня `.ru` →  
		- — сервер домена второго уровня (`1cloud`) →  
		- — и так далее, пока не найдётся сервер, который точно знает IP (либо знает. что такого **IP** нет).
	- Запрос начинает движение обратно.

2) **Обратное сопоставление:** IP‑адрес → доменное имя (используется, например, при проверке почтовых серверов). Осуществляется через специальный домен `in‑addr.arpa`.
	- Например, для получения DNS-имени для адреса 11.22.33.44 можно запросить у DNS-сервера запись 44.33.22.11.in-addr.arpa, и тот вернёт соответствующее символьное имя.
### Логическая структура DNS

DNS представляет собой **иерархическую распределённую базу данных**, часто описываемую как _дерево доменных имён_. Каждый узел в этом пространстве имеет свое уникальное имя.
Это логическое дерево «растет» из корневого домена, который является самым верхним уровнем иерархии DNS, а уже от корневого элемента ответвляются поддоменные зоны или узлы (компьютеры).

#### Основные уровни в логической структуре:

- **Корневой домен** — самый верхний уровень, обозначается точкой (`.`).
- **Домен верхнего уровня (TLD)** — например `.ru`, `.com`.
- **Домен второго уровня** — например `1cloud.ru`, `example.com`.
- **Поддомены (домен третьего уровня и ниже)** — например `panel.1cloud.ru`, `shop.example.com`.

Такая иерархия позволяет организовать пространство имён глобально и избежать конфликтов между именами.
#### Кто управляет DNS

##### Корневые DNS‑серверы

Существует **13 логических корневых серверов** DNS, которые координируют поиск по всему глобальному пространству имён. Реальные сервера могут быть физически распределены, но логически система остаётся с 13 корнями. Эти сервера поддерживаются 12-ю независимыми организациями.

- Например, сервер `a.root-servers.net` имеет IP-адрес `198.41.0.4` и находится в ведении компании Verisign, а `e.root-servers.net` (`192.203.230.10`) обслуживает НАСА.
- Они названы буква.root-servers.net — `буква` берется из английского алфавита от `A` до `M`.

Каждый из этих операторов предоставляет данную услугу бесплатно, а также обеспечивает бесперебойную работу, поскольку при отказе любого из этих серверов станут недоступны целые зоны интернета.

**Корневые серверы**:
- управляют корневой зоной DNS;
- направляют запросы к серверам доменов верхнего уровня (TLD);
- являются фундаментом системы DNS.

Ранее корневые DNS-серверы, являющиеся основой для обработки всех запросов о доменных именах в интернете, располагались в Северной Америке. Однако с внедрением технологии альтернативной адресации Anycast их фактическое число увеличилось с 13 до 123, но логически система осталась с первичными 13 точками.

- Например, в Северной Америке находятся 40 серверов (32,5%), в Европе – 35 (28,5%), еще 6 серверов располагаются в Южной Америке (4,9%) и 3 – в Африке (2,4%).

Координацией большинства доменов верхнего уровня (TLD) занимается «Корпорация по управлению доменными именами и IP-адресами» (ICANN).

Домен верхнего уровня .COM был создан одним из первых ещё в 1985 году. И сегодня это один из крупнейших TLD в интернете.

Виды TLD включают:
1) Национальные TLD. Обычно это двухбуквенные ISO-коды стран. — `.RU`, `.FR`,  `.EN`
2) Интернационализованные TLD-коды стран. — `.рус`, `.укр`
3) Общие TLD — `.NET`, `.ORG`, `.EDU` и т.д. (Обычно состоят из 3-х и более букв)
4) Инфраструктурные TLD — `.ARPA` (обычно используются в обратном DNS-поиске.)

### Безопасность DNS

Атаки на DNS — они могут приводить к массовым сбоям (DDoS-атаки на корневые серверы и случаи подмены записей, из-за которых сервисы становились недоступны). Это заставляет уделять защите DNS глобальное внимание.

Протокол DNS использует для работы TCP- или UDP-порт для ответов на запросы.
- **UDP** — для большинства запросов и ответов
- **TCP** — в отдельных случаях (например, передача больших ответов или зон)
Традиционно они отправляются в виде одной UDP-датаграммы.

**UDP-датаграмма** — это пакет данных, передаваемый без установления соединения и проверки доставки. Из-за этого DNS на UDP уязвим к атакам с подменой IP-адреса отправителя.

#### Подмена IP-адресов и борьба с ней

##### Spoofing (подмена источника)
**IP-spoofing** — это подделка исходного IP-адреса в пакете.

##### uRPF (Unicast Reverse Path Forwarding)

**uRPF** — это технология фильтрации трафика на маршрутизаторах.

Принцип работы:
- маршрутизатор проверяет:  *существует ли обратный маршрут к IP-адресу источника пакета*
- если маршрут отсутствует — пакет отбрасывается

uRPF **не является универсальным решением** и **не обеспечивает полную защиту** от подмены.

##### IP Source Guard

**IP Source Guard** — механизм фильтрации IP-пакетов на сетевых устройствах. Основывается на технологии uRPF и отслеживании DHCP-пакетов для фильтрации поддельного трафика на отдельных портах коммутатора.

**DHCP (Dynamic Host Configuration Protocol)** — протокол автоматической выдачи IP-адресов устройствам в сети.

**Отслеживание DHCP-пакетов** позволяет:
- определить, какому устройству был выдан конкретный IP
- построить таблицу соответствий _IP ↔ MAC ↔ порт_

Как работает:
- использует данные, полученные из DHCP-мониторинга
- проверяет, соответствует ли исходный IP пакета разрешённой привязке
- блокирует пакеты с поддельным IP

Назначение:
- предотвращение подмены IP внутри сети
- защита от локальных атак и злоупотреблений


##### dns-validator

**dns-validator** — утилита, для анализа DNS-трафика.

Возможности:
- отслеживает DNS-запросы и ответы
- проверяет соответствие заголовков и параметров
- уведомляет о несоответствиях между запросом и ответом

Назначение:
- диагностика ошибок и аномалий
- выявление подозрительного поведения DNS

Все эти меры **уменьшают вероятность атак**, но не дают абсолютной защиты.