
## Кратко

1) Проверка DNS-кэша браузера
2) Проверка DNS-кэша ОС
3) Запрос рекурсивному DNS-резолверу (ISP / публичный DNS)
4) Проверка кэша резолвера
5) Запрос к корневому DNS-серверу
6) Получение NS-записей TLD-зоны (.com)
7) Запрос к TLD-серверу
8) Получение NS-записей авторитетных серверов dnsimple.com
9) Запрос к одному из авторитетных DNS-серверов
10) Получение A/AAAA-записи
11) Кэширование ответа резолвером
12) Возврат IP клиенту
13) Кэширование ответа ОС и браузером1) 

## Развернуто
### Этап 1. Запрос от приложения (браузера)

Пользователь вводит URL:

```
https://dnsimple.com
```

Браузер:
- извлекает **доменное имя**
- формирует **DNS-запрос** (**DNS query**)

**DNS query** — это сетевой запрос с вопросом: 
«Какой IP-адрес соответствует этому доменному имени?»

На этом этапе браузер **не знает**, где сервер и существует ли он вообще.

### Этап 2. Проверка локальных кэшей

Перед выходом в сеть система проверяет кэши (по порядку):

1) Кэш браузера:
	- Браузер может хранить DNS-ответы, полученные ранее.
	- Если запись найдена и TTL не истёк — lookup завершается.

2) Кэш ОС:
	- Хранит DNS-записи
	- Информацию, полученную ранее от резолвера
	- Если запись есть — IP сразу возвращается браузеру

**Важно:**  
На этом этапе **сетевой запрос ещё не выполнялся**.

### Этап 3. Запрос к рекурсивному DNS-резолверу

Если локальных данных нет, ОС отправляет запрос **рекурсивному DNS-резолверу**.

Обычно это:
- DNS провайдера
- публичные DNS (8.8.8.8, 1.1.1.1)
#### DNS-резолвер

**DNS-резолвер** — это компонент (обычно сервер), который:
- принимает DNS-запрос от клиента
- выполняет поиск ответа
- возвращает **готовый результат** (IP-адрес)

**Рекурсивный DNS-резолвер** — это DNS-резолвер, который:
- сам обращается к root → TLD → authoritative серверам
- выполняет **весь процесс поиска**
- скрывает сложность от клиента

### Этап 4. Проверка кэша резолвера

Резолвер — **проверяет свой кэш**.

Если запись есть и TTL не истёк:
- резолвер сразу возвращает IP клиенту
- остальные этапы пропускаются

### Этап 5. Обращение к корневым DNS-серверам (Root)

Если у резолвера нет ответа, начинается **итеративный поиск**.

**Корневые DNS-серверы** — верхний уровень DNS-иерархии.

Корневые **DNS-серверы**:
- **не знают IP сайтов**
- знают, какие серверы отвечают за домены верхнего уровня (TLD)

Резолвер задаёт вопрос:
> «Кто отвечает за домены `.com`?»

В ответ root-сервер возвращает:
- список TLD-серверов для `.com`


### Этап 6. Обращение к TLD-серверам

**TLD (Top-Level Domain) сервер** — сервер, обслуживающий домены верхнего уровня:

Резолвер обращается к TLD-серверу и спрашивает:

> «Кто является авторитетным DNS-сервером для `dnsimple.com`?»

TLD-сервер:
- **не знает IP**
- возвращает адреса **авторитетных серверов домена**

### Этап 7. Обращение к авторитетному DNS-серверу

**Авторитетный DNS-сервер** — сервер, который:
- хранит DNS-записи конкретного домена
- является источником истины для этого домена

Резолвер задаёт финальный вопрос:

> «Какой IP у `www.dnsimple.com`?»

Авторитетный сервер возвращает:

- A-запись (IPv4) или AAAA-запись (IPv6)
- вместе с TTL

Это **окончательный ответ**.

### Этап 8. Возврат ответа клиенту

Резолвер:

1. сохраняет ответ в своём кеше
2. отправляет IP клиенту (ОС)
3. ОС передаёт IP браузеру
4. браузер может сохранить запись в своём кеше

DNS lookup завершён.

### Этап 9. Использование IP

После получения IP:
- начинается установка TCP-соединения
- затем TLS (если HTTPS)
- затем HTTP-запрос

DNS больше не участвует, пока:
- не истечёт TTL
- или не потребуется новый домен